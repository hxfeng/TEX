require(["jquery"],function(h){var f=0;var e=false;var j=[];var i=20;var a=function(p){p.trigger("xwiki:flavorpicker:updated",{elements:p[0]})};var o=function(){l();d()};var d=function(){var p="$escapetool.javascript($services.flavor.getSearchValidFlavorsStatusURL())";h.getJSON(p).done(function(s){var r=s.state;var u=h("#xwiki-flavor-picker-progress-background");if(u.length){var q=h("#xwiki-flavor-picker-progress-bar");u.find("input").attr("value",r);if(r=="RUNNING"){u.removeClass("hidden");var t=s.progress.offset;q.css("width",(t*100)+"%")}else{u.addClass("hidden")}g()}}).fail(function(){new XWiki.widgets.Notification("$escapetool.javascript($services.localization.render('flavor.picker.ajaxError'))","error")})};var l=function(){var p="$escapetool.javascript($doc.getURL('view', 'xpage=flavor/picker_flavors'))";h.getJSON(p).done(function(q){j=q;h.each(q,function(r,s){c(r,s)});n(h(".xwiki-flavor-picker"))}).fail(function(q){new XWiki.widgets.Notification("$escapetool.javascript($services.localization.render('flavor.picker.ajaxError'))","error")})};var c=function(z,w){var v=h(".xwiki-flavor-picker");var C=v.find('input[name="fieldName"]').attr("value");var t=v.find("ul");var r=w.id.id+":::"+w.id.version.value;var s=t.find('input[value="'+r+'"]');if(s.length==0){var A=h('<li class="xwiki-flavor-picker-option"/>');A.append(h('<input type="radio"/>').attr("name",C).attr("value",r).attr("id",C+"_"+z));A.append("<span class=\"xwiki-flavor-picker-option-icon\">$escapetool.javascript($services.icon.renderHTML('wiki'))</span>");var p=h("<div/>");var y=h("<div/>");y.attr("for",C+"_"+z);var B;if(w.name!=null&&w.name!=""){B=w.name}else{B=w.id.id}if(w.website!=null&&w.website!=""){y.append(h('<a class="popup"/>').attr("href",w.website).text(B))}else{y.text(B)}y.append(" ");y.append(h("<small/>").text(w.id.version.value));var u="$escapetool.javascript($services.icon.renderHTML('star'))";if(w.rating!=null&&w.rating>0){y.append(Array(Math.round(w.rating)).join(u))}p.append(y);if(w.authors.length>0){var x=h('<p class="authors"/>');var q=h("<small/>");q.text("$escapetool.javascript($services.localization.render('flavor.picker.authorsBy')) ");h.each(w.authors,function(D,E){if(D>0){q.append(", ")}if(E.url!=null&&E.url!=""){q.append(h("<a/>").attr("href",E.url).text(E.name))}else{q.append(E.name)}});x.append(q);p.append(x)}if(w!=null&&w.summary!=""){p.append(h('<p class="xHint"/>').text(w.summary))}A.append(h('<input type="hidden" name="match"/>').attr("value",JSON.stringify(w)));A.append(p);t.append(A)}};var g=function(){var q=h("#xwiki-flavor-picker-progress-background");if(q.length){var p=q.find("input").attr("value");if(p!="FINISHED"){setTimeout(o,100)}}};var k=function(p,r){var q=p.find('input[name="match"]').attr("value");if(q.toLowerCase().indexOf(r)>-1){p.removeClass("hidden")}else{p.addClass("hidden")}};var b=function(q){var p=h(".xwiki-flavor-picker");if(!q||h.trim(q)===""){p.find("li").removeClass("hidden")}else{p.find("li").each(function(r){k(h(this),q)})}};var n=function(p){p.find(".xwiki-flavor-picker-option").click(function(s){var r=h(this);var q=r.parents(".xwiki-flavor-picker");q.find(".xwiki-flavor-picker-option-selected").removeClass("xwiki-flavor-picker-option-selected");r.find("input").prop("checked",true);r.addClass("xwiki-flavor-picker-option-selected");a(q)});p.find(".xwiki-flavor-picker-option a.popup").click(function(q){window.open(this.href,"flavor-popup",config="height=600, width=700, toolbar=no, menubar=no, scrollbars=yes, resizable=yes, location=no, directories=no, status=yes");return false});a(p)};var m=function(){n(h(".xwiki-flavor-picker"));h("input.xwiki-flavor-picker-filter").keyup(function(){var p=h(this);var q=p.val();b(q)});h(".xwiki-flavor-picker-noflavor").click(function(q){var p=h(this).parents(".xwiki-flavor-picker");p.find(".xwiki-flavor-picker-option-selected").removeClass("xwiki-flavor-picker-option-selected");a(p)});g()};h(window).ready(m)});