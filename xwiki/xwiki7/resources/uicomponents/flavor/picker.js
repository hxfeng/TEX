require(["jquery"],function(e){var d=0;var a=false;var f=function(h){h.trigger("xwiki:flavorpicker:updated",{elements:h[0]})};var c=function(i,h,l){var k=++d;var j=i.find(".xwiki-flavor-picker-results-container");j.addClass("loading");j.find(".xwiki-flavor-picker-results").fadeOut();if(a){a.abort()}e.ajax(h,{data:l}).done(function(n){if(k!=d){return}j[0].innerHTML=n;j.removeClass("loading");var m=i.find(".xwiki-flavor-picker-results");m.hide();m.fadeIn();b(i)}).fail(function(){new XWiki.widgets.Notification("$escapetool.javascript($services.localization.render('flavor.picker.ajaxError'))","error");j.removeClass("loading");i.find(".xwiki-flavor-picker-results").fadeIn()})};var b=function(h){h.find(".xwiki-flavor-picker-option").click(function(k){var j=e(this);var i=j.parents(".xwiki-flavor-picker");i.find(".xwiki-flavor-picker-option-selected").removeClass("xwiki-flavor-picker-option-selected");j.find("input").prop("checked",true);j.addClass("xwiki-flavor-picker-option-selected");f(i)});h.find(".xwiki-flavor-picker-option a.popup").click(function(i){window.open(this.href,"flavor-popup",config="height=600, width=700, toolbar=no, menubar=no, scrollbars=yes, resizable=yes, location=no, directories=no, status=yes");return false});h.find(".paginationFilter a").click(function(j){var i=e(this).parents(".xwiki-flavor-picker");c(i,this.href,{});return false});f(h)};var g=function(){b(e(".xwiki-flavor-picker"));e("input.xwiki-flavor-picker-filter").keyup(function(){var h=e(this);var i=h.val();setTimeout(function(){if(h.val()==i){var k=h.parents(".xwiki-flavor-picker");var j="$escapetool.javascript($doc.getURL('view', 'xpage=flavor/picker_results'))";var m=k.find("input[type='radio']").attr("name");var l={fieldName:m,firstIndex:0,filter:h.val()};c(k,j,l)}},500)});e(".xwiki-flavor-picker-noflavor").click(function(i){var h=e(this).parents(".xwiki-flavor-picker");h.find(".xwiki-flavor-picker-option-selected").removeClass("xwiki-flavor-picker-option-selected");f(h)})};e(window).ready(g)});